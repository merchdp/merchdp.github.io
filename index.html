<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PandyVR Merch with Admin Panel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* Base Styles */
    :root { --main-color: #00ff88; }
    body { margin:0; padding:0; background:#000; color:#fff; font-family:Arial,sans-serif; }
    header { background:#111; padding:20px; text-align:center; font-size:28px; color:var(--main-color); text-shadow:0 0 8px var(--main-color); }
    nav { display:flex; justify-content:center; gap:20px; background:#111; padding:10px; }
    nav button { background:none; border:none; color:var(--main-color); font-size:16px; cursor:pointer; }
    nav button.active { text-decoration:underline; }
    section { display:none; padding:30px; text-align:center; }
    section.active { display:block; }
    .merch-items { display:flex; justify-content:center; flex-wrap:wrap; gap:20px; margin-top:20px }
    .item-card { background:#111; padding:20px; border-radius:10px; width:250px; box-shadow:0 0 10px rgba(0,255,136,0.3); }
    .item-card img { width:100%; border-radius:8px; }
    .item-card button { background:none; border:1px solid var(--main-color); color:var(--main-color); padding:6px 12px; margin-top:10px; cursor:pointer; border-radius:6px; }
    .item-card button:disabled { opacity:0.5; cursor: not-allowed; }
    .status-label { margin-top:8px; font-style:italic; color:#aaa; }
    #wishlist-list { list-style:none; padding:0; max-width:600px; margin:auto; }
    #wishlist-list li { margin:8px 0; }
    #noti { position:fixed; top:-60px; left:50%; transform:translateX(-50%); background:var(--main-color); color:#000; padding:12px 20px; border-radius:5px; font-weight:bold; box-shadow:0 0 10px var(--main-color); transition:top .4s, opacity .4s; opacity:0; z-index:999; }
    #noti.show { top:20px; opacity:1; }

    /* Auth Panel Styles */
    #auth-panel { text-align:center; padding:10px; }
    #auth-panel input { margin:5px; padding:8px; width:200px; }

    /* Admin Button & Panel */
    #admin-btn { position:fixed; bottom:20px; right:20px; background:var(--main-color); color:#000; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; z-index:1000; }
    #admin-panel { display:none; position:fixed; bottom:70px; right:20px; background:#111; padding:20px; border-radius:10px; width:300px; max-height:400px; overflow:auto; box-shadow:0 0 10px rgba(0,255,136,0.5); z-index:1000; }
    #admin-panel h3 { margin-top:0; }
    #admin-panel input, #admin-panel select { width:100%; margin:6px 0; padding:6px; }
    #admin-panel button { padding:6px 10px; margin-right:8px; border:none; background:var(--main-color); color:#000; cursor:pointer; border-radius:6px; }
    .prd-item { background:#222; padding:8px; border-radius:6px; margin-bottom:8px; }

    footer { background:#111; padding:10px; text-align:center; color:#888; margin-top:30px; font-size:14px; }
  </style>
</head>
<body>

  <header>PandyVR Merch</header>
  <div id="noti">✅ Updated!</div>

  <div id="auth-panel">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
    <span id="user-info" style="display:none;">
      Logged in as <span id="user-email"></span> <button onclick="logout()">Logout</button>
    </span>
  </div>

  <nav>
    <button class="tab-button active" data-tab="home">Home</button>
    <button class="tab-button" data-tab="shop">Shop</button>
    <button class="tab-button" data-tab="wishlist">Wishlist</button>
  </nav>

  <section id="home" class="active">
    <h2>Welcome!</h2>
    <p>Explore exclusive Gorilla Tag merch by <strong>PandyVR</strong>.</p>
    <p>Log in to save your wishlist.</p>
  </section>

  <section id="shop">
    <h2>Merch</h2>
    <div class="merch-items" id="merch-container"></div>
  </section>

  <section id="wishlist">
    <h2>Your Wishlist</h2>
    <ul id="wishlist-list"></ul>
  </section>

  <footer>&copy; 2025 PandyVR. All rights reserved.</footer>

  <button id="admin-btn" onclick="unlockAdmin()">Admin</button>
  <div id="admin-panel">
    <h3>Admin Panel</h3>
    <div id="prd-list"></div>
    <hr>
    <h4>Add / Edit Product</h4>
    <input id="prd-id" type="hidden">
    <input id="prd-title" placeholder="Title">
    <input id="prd-img" placeholder="Image URL">
    <select id="prd-status">
      <option value="in_stock">In Stock</option>
      <option value="out_of_stock">Out of Stock</option>
      <option value="coming_soon">Coming Soon</option>
    </select>
    <button onclick="saveProduct()">Save</button>
    <button onclick="cancelEdit()">Cancel</button>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = { /* your config here */ };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let user = null;

    // Notification
    function showNoti(msg) {
      const n = document.getElementById("noti");
      n.textContent = msg;
      n.classList.add("show");
      setTimeout(() => n.classList.remove("show"), 2000);
    }

    // Auth
    auth.onAuthStateChanged(u => {
      user = u;
      document.getElementById("user-info").style.display = u ? "inline" : "none";
      document.getElementById("user-email").textContent = u?.email || "";
      loadWishlist();
    });
    function login() { auth.signInWithEmailAndPassword(email.value, password.value).catch(e=>alert(e.message)); }
    function signup() { auth.createUserWithEmailAndPassword(email.value,password.value).catch(e=>alert(e.message)); }
    function logout() { auth.signOut(); }

    // Tabs
    document.querySelectorAll(".tab-button").forEach(b => {
      b.addEventListener("click", () => {
        document.querySelectorAll(".tab-button").forEach(x => x.classList.remove("active"));
        document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
        b.classList.add("active");
        document.getElementById(b.dataset.tab).classList.add("active");
      });
    });

    // Load products
    db.ref("products").on("value", snap => {
      const data = snap.val() || {};
      const cont = document.getElementById("merch-container");
      cont.innerHTML = "";
      Object.entries(data).forEach(([id, p]) => {
        const div = document.createElement("div");
        div.classList.add("item-card");
        div.innerHTML = `
          <img src="${p.image}" alt="${p.title}">
          <h3>${p.title}</h3>
          <div class="status-label">${p.status.replace('_',' ')}</div>
          <button ${p.status!=="in_stock"?'disabled':''} onclick="addToWishlist('${id}')">❤️ Wishlist</button>
        `;
        cont.appendChild(div);
      });
      loadWishlist();
      populateAdminList(data);
    });

    // Wishlist
    function addToWishlist(id) {
      if (!user) return alert("Please log in first.");
      const ref = db.ref(`wishlists/${user.uid}`);
      ref.once("value", s => {
        const arr = s.val() || [];
        if (!arr.includes(id)) {
          arr.push(id); ref.set(arr);
          showNoti("✅ Added to wishlist!");
          loadWishlist();
        }
      });
    }
    function loadWishlist() {
      if (!user) return;
      db.ref(`wishlists/${user.uid}`).once("value", s => {
        const arr = s.val() || [];
        const list = document.getElementById("wishlist-list");
        list.innerHTML = "";
        arr.forEach(id => {
          db.ref(`products/${id}`).once("value", ps => {
            const p = ps.val();
            if (p) {
              const li = document.createElement("li");
              li.textContent = p.title;
              const btn = document.createElement("button");
              btn.textContent="❌"; btn.onclick = ()=>{
                const newArr = arr.filter(x=>x!==id);
                db.ref(`wishlists/${user.uid}`).set(newArr);
                loadWishlist();
              };
              li.appendChild(btn);
              list.appendChild(li);
            }
          });
        });
      });
    }

    // Admin code logic
    const ADMIN_CODE = "12907654";
    function unlockAdmin() {
      const code = prompt("Enter admin code:");
      if (code === ADMIN_CODE) {
        document.getElementById("admin-panel").style.display = "block";
      } else alert("Incorrect code.");
    }

    // Admin functions
    function populateAdminList(data) {
      const prdList = document.getElementById("prd-list");
      prdList.innerHTML = "";
      Object.entries(data).forEach(([id, p]) => {
        const d = document.createElement("div"); d.classList.add("prd-item");
        d.innerHTML = `
          <b>${p.title}</b>
          <button onclick="editProduct('${id}')">Edit</button>
          <button onclick="deleteProduct('${id}')">Delete</button>
        `;
        prdList.appendChild(d);
      });
    }
    function saveProduct() {
      const id = document.getElementById("prd-id").value || db.ref("products").push().key;
      const obj = {
        title: document.getElementById("prd-title").value,
        image: document.getElementById("prd-img").value,
        status: document.getElementById("prd-status").value
      };
      db.ref("products/" + id).set(obj);
      clearForm();
      showNoti("✅ Saved product");
    }
    function editProduct(id) {
      db.ref("products/" + id).once("value", s => {
        const p = s.val();
        document.getElementById("prd-id").value = id;
        document.getElementById("prd-title").value = p.title;
        document.getElementById("prd-img").value = p.image;
        document.getElementById("prd-status").value = p.status;
      });
    }
    function deleteProduct(id) {
      if (confirm("Delete this product?")) {
        db.ref("products/" + id).remove();
        showNoti("✅ Deleted product");
      }
    }
    function cancelEdit() {
      clearForm();
    }
    function clearForm() {
      document.getElementById("prd-id").value = "";
      document.getElementById("prd-title").value = "";
      document.getElementById("prd-img").value = "";
      document.getElementById("prd-status").value = "in_stock";
    }
  </script>
</body>
</html>
